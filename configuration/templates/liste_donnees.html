{% include 'template.html' %}
{% load custom_tags %}
{% load my_custom_filters %}.

<head>
<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-4" align="right"></div>
        <form class="item" method="POST">
        {% csrf_token %}
        <div class="col-sm-3" align="right">
            <select class="form-select" name="name">
                <option value=""> SÃ©lectionne une machine...</option>
                {% for machine in machines %}
                <option value="{{machine.name}}">{{machine.name}}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-4" align="left">
              <input type="submit" value="Send Request" name="change_machine"/>
        </div>
        </form>
        <br></br>
        </div>
        {% with True as new_row %}
            {% for data_graphique in data_graphiques %}
                {% if new_row %}
                     <div class="row">
                {% endif %}
            
                {% if data_graphique.0 == "Texte" %}
                    {% if not new_row %}
                    </div> 
                    <div class="row">
                    {% endif %}
                <div class="col-sm-12 border border-secondary">
                    <p class="text-center"> {{data_graphique.1}} : {{data_graphique.2}}</p>
                </div>
                </div>
                {% update_variable True as new_row %}
                {% endif %}
                
                {% if data_graphique.0 == "Fleche" %}
                     <div class="col-sm-6 border border-secondary">
                         <p class="text-center"> {{data_graphique.1}} </p>
                         <p class="text-center"> {{data_graphique.2}} </p>
                     </div>
                      {% if new_row %}
                           {% update_variable False as new_row %}
                      {% else %}
                          </div> 
                          {% update_variable True as new_row %}
                      {% endif %}
                 {% endif %}
            {% endfor%}
        {% endwith %}
        {% with last_sublist=data_graphiques|last %}
            {% if last_sublist.0 == "Fleche" %}
                {% with penultimate_sublist=data_graphiques|get_penultimate %}
                    {% if penultimate_sublist.0 != "Fleche" %}
                        </div>
                    {% endif %}
                {% endwith %}
            {% endif %}
        {% endwith %}
  </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKx5Ckc5/ue7z10hL0MkEJw4vI1Gvi8Tbsk5pyt4lTw5PUb2MGagf1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-z+kAwMy0oD9PlzPGyHtioTFzScPtm5A8zsnL1GzsyQ3c/yAozZpk1smkKyTFiII3" crossorigin="anonymous"></script>
